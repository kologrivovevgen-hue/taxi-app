<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Попутчик 2026</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; padding: 15px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #0088cc; }
        label { display: block; margin: 10px 0 5px; font-weight: bold; }
        select, input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; font-size: 16px; }
        .option-row { display: flex; align-items: center; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 8px; }
        .check-box { width: 20px; height: 20px; }
        #pr { font-size: 22px; font-weight: bold; color: #0088cc; }
        button { width: 100%; padding: 15px; background: #0088cc; color: white; border: none; border-radius: 10px; font-size: 18px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>🚕 Заказать такси</h2>
        <label>📍 Откуда:</label>
        <select id="f" onchange="calc()">
            <option>🌲 КЕДРОВЫЙ</option><option>🏘️ ОСТАНИНО</option><option>🏡 ПУДИНО</option><option>🌾 ЛУШНИКОВО</option><option>🏗️ КУЛАЦКИЙ</option><option>🏠 КАЛИНИНСК</option><option>✈️ АЭРОПОРТ</option><option>🍏 ДАЧИ</option>
        </select>
        <label>🏁 Куда:</label>
        <select id="t" onchange="calc()">
            <option>🏘️ ОСТАНИНО</option><option>🌲 КЕДРОВЫЙ</option><option>🏡 ПУДИНО</option><option>🌾 ЛУШНИКОВО</option><option>🏗️ КУЛАЦКИЙ</option><option>🏠 КАЛИНИНСК</option><option>✈️ АЭРОПОРТ</option><option>🍏 ДАЧИ</option>
        </select>
        <label>📅 Дата:</label>
        <select id="ds" onchange="calc()"></select>
        <label>⏰ Время:</label>
        <input type="time" id="tm" onchange="calc()">
        
        <div class="option-row">
            <span>📦 Багаж / Груз (+50р)</span>
            <input type="checkbox" id="cargo" class="check-box" onchange="calc()">
        </div>
        <div class="option-row">
            <span>👶 С детьми (+50р)</span>
            <input type="checkbox" id="kids" class="check-box" onchange="calc()">
        </div>
        <label>🛑 Остановки (+50р):</label>
        <input type="number" id="stops" value="0" min="0" onchange="calc()">

        <div style="text-align:center; margin: 15px 0;">
            Итого: <span id="pr">400р</span>
        </div>
        <button onclick="send()">ОТПРАВИТЬ ЗАКАЗ</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        const P = {
            "🌲 КЕДРОВЫЙ-🏘️ ОСТАНИНО": 300, "🏘️ ОСТАНИНО-🌲 КЕДРОВЫЙ": 300,
            "🌲 КЕДРОВЫЙ-🏡 ПУДИНО": 350, "🏡 ПУДИНО-🌲 КЕДРОВЫЙ": 350,
            "🌲 КЕДРОВЫЙ-🌾 ЛУШНИКОВО": 400, "🌾 ЛУШНИКОВО-🌲 КЕДРОВЫЙ": 400,
            "🌲 КЕДРОВЫЙ-🏗️ КУЛАЦКИЙ": 450, "🏗️ КУЛАЦКИЙ-🌲 КЕДРОВЫЙ": 450,
            "🌲 КЕДРОВЫЙ-🏠 КАЛИНИНСК": 500, "🏠 КАЛИНИНСК-🌲 КЕДРОВЫЙ": 500,
            "🌲 КЕДРОВЫЙ-🌲 КЕДРОВЫЙ": 200, "🌲 КЕДРОВЫЙ-✈️ АЭРОПОРТ": 400,
            "✈️ АЭРОПОРТ-🌲 КЕДРОВЫЙ": 400, "🌲 КЕДРОВЫЙ-🍏 ДАЧИ": 400,
            "🍏 ДАЧИ-🌲 КЕДРОВЫЙ": 400, "🏠 КАЛИНИНСК-✈️ АЭРОПОРТ": 450,
            "🏠 КАЛИНИНСК-🍏 ДАЧИ": 950, "🏗️ КУЛАЦКИЙ-🍏 ДАЧИ": 900,
            "🌾 ЛУШНИКОВО-🍏 ДАЧИ": 850, "🏡 ПУДИНО-🍏 ДАЧИ": 800,
            "🏘️ ОСТАНИНО-🍏 ДАЧИ": 750, "🏗️ КУЛАЦКИЙ-✈️ АЭРОПОРТ": 450,
            "🌾 ЛУШНИКОВО-✈️ АЭРОПОРТ": 450, "🏡 ПУДИНО-✈️ АЭРОПОРТ": 450,
            "🏘️ ОСТАНИНО-✈️ АЭРОПОРТ": 450
        };

        function fill() {
            const s = document.getElementById('ds');
            const now = new Date();
            for(let i=0; i<3; i++) {
                let d = new Date(); d.setDate(now.getDate() + i);
                let label = (i===0?"Сегодня ":(i===1?"Завтра ":"")) + d.toLocaleDateString('ru-RU',{month:'short',day:'numeric'});
                s.add(new Option(label, d.toISOString().split('T')[0]));
            }
            document.getElementById('tm').value = String(now.getHours()).padStart(2,'0')+":"+String(now.getMinutes()).padStart(2,'0');
        }

        function calc() {
            let f = document.getElementById('f').value, t = document.getElementById('t').value;
            let base = P[f+"-"+t] || 400;
            let h = parseInt(document.getElementById('tm').value.split(':')[0]);
            if(h >= 22 || h < 8) base *= 2;
            if(document.getElementById('cargo').checked) base += 50;
            if(document.getElementById('kids').checked) base += 50; // +50р за детей
            base += (parseInt(document.getElementById('stops').value) * 50);
            document.getElementById('pr').innerText = base + "р";
        }

        function send() {
            tg.sendData(JSON.stringify({
                from: document.getElementById('f').value, to: document.getElementById('t').value,
                date: document.getElementById('ds').options[document.getElementById('ds').selectedIndex].text,
                time: document.getElementById('tm').value,
                cargo: document.getElementById('cargo').checked ? "Да" : "Нет",
                kids: document.getElementById('kids').checked ? "Да" : "Нет",
                stops: document.getElementById('stops').value,
                price: document.getElementById('pr').innerText
            }));
        }
        fill(); calc();
    </script>
</body>
</html>